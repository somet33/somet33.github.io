(this.webpackJsonpjunqi=this.webpackJsonpjunqi||[]).push([[0],{18:function(e,t,a){},19:function(e,t,a){},20:function(e,t,a){},21:function(e,t,a){},23:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a.n(n),s=a(11),o=a.n(s),r=(a(18),a(13)),l=a(12),c=a(3),d=a(1),h=a(5),u=a(6),f=a(4),v=a(8),p=a(7),b=(a(19),a(20),a(21),a(0)),C={0:"\ud83d\udea9",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"\ud83d\udca3",100:"Mine"},g={O:"orange",B:"blue",G:"green",P:"purple"},j=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(e){return Object(h.a)(this,a),t.call(this,e)}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.piece,t="piece ".concat(g[e.color]);return this.props.isSelected&&(t+=" selected"),t+=" en",Object(b.jsx)("div",{className:t,children:null!=e.rank&&C[e.rank]})}}]),a}(i.a.Component),m=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(e){return Object(h.a)(this,a),t.call(this,e)}return Object(u.a)(a,[{key:"render",value:function(){var e,t,a=this,n=this.props.cell,i=n.piece;i&&(e=Object(b.jsx)(j,{piece:i,isSelected:this.props.isSelected}));var s="cell-svg";"normal"===n.type?t=Object(b.jsx)("rect",{width:"100%",height:"100%",rx:"4px",ry:"4px",strokeWidth:"4px",fill:"rgb(65,68,37)",stroke:"rgb(104,144,176)"}):"camp"===n.type?t=Object(b.jsx)("circle",{r:"60%",cx:"50%",cy:"50%",strokeWidth:"4px",fill:"rgb(65,68,37)",stroke:"rgb(192,144,88)"}):"base"===n.type?t=Object(b.jsx)("circle",{r:"40%",cx:"50%",cy:"50%",strokeWidth:"4px",fill:"rgb(65,68,37)",stroke:"rgb(144,180,104)"}):"center"===n.type&&(t=Object(b.jsx)("rect",{width:"100%",height:"100%",rx:"4px",ry:"4px",strokeWidth:"4px",fill:"rgb(65,68,37)",stroke:"rgb(104,144,176)"}),s+=" center-svg");return this.props.isInLastPath,Object(b.jsxs)("div",{className:"cell-container",onClick:function(){return a.props.cellClicked(n)},children:[e||n.id,Object(b.jsx)("svg",{id:n.id,className:s,children:t})]})}}]),a}(i.a.Component),O={O:"G",B:"P",G:"O",P:"B"},y={O:"B",B:"G",G:"P",P:"O"},k={O:"P",B:"O",G:"B",P:"G"},w=834,x="rgb(104,144,176)",P="rgb(200,236,240)",S=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(h.a)(this,a),n=t.call(this,e);for(var i={},s={},o=[9,1,6,3,3,5,6,7,8,1,7,10,4,2,3,5,1,2,100,10,2,100,100,0,4],r=0,l=function(e,t,a){null==e[t]&&(e[t]=new Set),e[t].add(a),null==e[a]&&(e[a]=new Set),e[a].add(t)},c=0;c<6;c++)for(var d=function(e){var t="F".concat(c).concat(e),a=void 0,n=null;"camp"!==(a=(1===c||3===c)&&(1===e||3===e)||2===c&&2===e?"camp":5!==c||1!==e&&3!==e?"normal":"base")&&(n={color:"O",rank:o[r]},r++);var d={id:t,piece:n,type:a,isOnRailroad:0===c||4===c||(0===e||4===e)&&5!==c};i[t]=d,c>0&&l(s,t,"F".concat(c-1).concat(e)),c<5&&l(s,t,"F".concat(c+1).concat(e)),e>0&&l(s,t,"F".concat(c).concat(e-1)),e<4&&l(s,t,"F".concat(c).concat(e+1)),"camp"===a&&[[c-1,e-1],[c-1,e+1],[c+1,e-1],[c+1,e+1]].forEach((function(e){return l(s,t,"F".concat(e[0]).concat(e[1]))}))},u=0;u<5;u++)d(u);return n.state={cells:null,edges:null,formationEdges:s,railPaths:null,playerId:null,ownColor:null,currentTurnColor:null,lastMovePath:[],formationCells:i,roadsDrawn:!1,selectedCell:null,isConnected:!1,ws:null},n.board=null,n.canvas=null,n.arrowCanvas=null,n.setBoardRef=function(e){n.board=e},n.setCanvasRef=function(e){n.canvas=e},n.setArrowCanvasRef=function(e){n.arrowCanvas=e},n.cellClicked=n.cellClicked.bind(Object(f.a)(n)),n.drawRoads=n.drawRoads.bind(Object(f.a)(n)),n.formationCellClicked=n.formationCellClicked.bind(Object(f.a)(n)),n.joinGame=n.joinGame.bind(Object(f.a)(n)),n}return Object(u.a)(a,[{key:"cellClicked",value:function(e){var t=this,a=function(e){return"base"!==e.type&&e.piece&&100!==e.piece.rank&&t.isOwnPiece(e.piece)&&t.state.currentTurnColor===t.state.ownColor};if(this.state.selectedCell){var n=this.state.selectedCell;if(e.id===n.id)return void this.setState({selectedCell:null});this.isOwnPiece(e.piece)?a(e)&&this.setState({selectedCell:e}):(console.log("send"),this.state.ws.send(JSON.stringify({type:"move",data:{srcCellId:this.state.selectedCell.id,destCellId:e.id}})))}else a(e)&&this.setState({selectedCell:e})}},{key:"formationCellClicked",value:function(e){if(this.state.selectedCell){var t=this.state.selectedCell;if(e.id===t.id)return void this.setState({selectedCell:null});if("camp"===e.type)return;var a=parseInt(t.id[1]),n=parseInt(e.id[1]);if(10===t.piece.rank&&0===n||10===e.piece.rank&&0===a)return;if(100===t.piece.rank&&n<4||100===e.piece.rank&&a<4)return;if(0===t.piece.rank&&"base"!==e.type||0===e.piece.rank&&"base"!==t.type)return;t.piece,Object(d.a)(Object(d.a)({},this.state.formationCells),{},Object(c.a)({},t.id,Object(d.a)({},this.state)));this.setState((function(a){var n;t.piece;return{selectedCell:null,formationCells:Object(d.a)(Object(d.a)({},a.formationCells),{},(n={},Object(c.a)(n,t.id,Object(d.a)(Object(d.a)({},a.formationCells[t.id]),{},{piece:e.piece})),Object(c.a)(n,e.id,Object(d.a)(Object(d.a)({},a.formationCells[e.id]),{},{piece:t.piece})),n))}}))}else this.setState({selectedCell:e})}},{key:"isOwnPiece",value:function(e){return e&&e.color===this.state.ownColor}},{key:"getRailPath",value:function(e,t,a,n){if(!a.isOnRailroad||!n.isOnRailroad)return null;for(var i=new Map,s=[a],o=new Set([a.id]);s.length;){var r,c=s.shift(),d=t[c.id],h=Object(l.a)(d);try{for(h.s();!(r=h.n()).done;){var u=r.value;if(u===n.id){i.set(u,c.id);for(var f=[],v=n.id;null!=v;)f.unshift(v),v=i.get(v);return console.log("asdfad",f,i),f}var p=e[u];null==p.piece&&p.isOnRailroad&&!o.has(u)&&(o.add(u),s.push(p),i.set(u,c.id))}}catch(b){h.e(b)}finally{h.f()}}return null}},{key:"isValidMove",value:function(e){var t=this.state.selectedCell;if(t.id===e.id)return!1;if(e.piece&&this.isOwnPiece(e.piece))return!1;if(t.isOnRailroad&&e.isOnRailroad){if(1===t.piece.rank)return null!=this.getRailPath(t,e);var a=this.state.railPaths.find((function(a){return a.includes(t.id)&&a.includes(e.id)}));if(!a)return!1;for(var n=a.findIndex((function(e){return e===t.id})),i=a.findIndex((function(t){return t===e.id})),s=Math.min(n,i),o=Math.max(n,i),r=s+1;r<o;r++){if(null!=this.state.cells[a[r]].piece)return!1}return!0}return this.state.edges[t.id].has(e.id)}},{key:"comparePieces",value:function(e,t){return 10===e.rank||10===t.rank||e.rank===t.rank?null:1===e.rank&&100===t.rank||100===e.rank&&1===t.rank?1===e.rank?e:t:e.rank>t.rank?e:t}},{key:"moveSelectedPieceToCell",value:function(e){var t=this;this.setState((function(a){var n=a.selectedCell.id,i=a.selectedCell.piece,s=e.id,o=Object(d.a)(Object(d.a)({},a.cells),{},Object(c.a)({},n,Object(d.a)(Object(d.a)({},a.cells[n]),{},{piece:null})));return null==e.piece||t.comparePieces(i,e.piece)===i?o[s]=Object(d.a)(Object(d.a)({},a.cells[s]),{},{piece:i}):null==t.comparePieces(i,e.piece)&&(o[s]=Object(d.a)(Object(d.a)({},a.cells[s]),{},{piece:null})),{selectedCell:null,cells:o}}))}},{key:"getLastMovePath",value:function(e,t,a){if(!a)return[];a.color;var n=a.srcCellId,i=a.destCellId,s=e[n],o=e[i];if(console.log(s,o),s.isOnRailroad&&o.isOnRailroad){var r=this.getRailPath(e,t,s,o);return console.log(r),r}return[n,i]}},{key:"isSelected",value:function(e){return!!this.state.selectedCell&&this.state.selectedCell.id===e.id}},{key:"renderTopCells",value:function(){for(var e=[],t=5;t>=0;t--)for(var a=4;a>=0;a--){var n=this.state.cells["".concat(O[this.state.ownColor]).concat(t).concat(a)];e.push(Object(b.jsx)(m,{cell:n,isSelected:this.isSelected(n),cellClicked:this.cellClicked},n.id))}return Object(b.jsx)("div",{className:"player-territory top-territory",children:e})}},{key:"renderLeftBottomRightCells",value:function(){var e=this,t=[],a={W:"player-territory left-territory",S:"player-territory bottom-territory",E:"player-territory right-territory"};return["W","S","E"].forEach((function(n){var i,s=[];i="W"===n?y[e.state.ownColor]:"E"===n?k[e.state.ownColor]:e.state.ownColor;for(var o=0;o<6;o++)for(var r=0;r<5;r++){var l=e.state.cells["".concat(i).concat(o).concat(r)];s.push(Object(b.jsx)(m,{cell:l,isSelected:e.isSelected(l),cellClicked:e.cellClicked},l.id))}t.push(Object(b.jsx)("div",{className:a[n],children:s}))})),t}},{key:"renderCenterCells",value:function(){for(var e=[],t={O:[0,1,2,3,4,5,6,7,8],B:[2,5,8,1,4,7,0,3,6],G:[8,7,6,5,4,3,2,1,0],P:[6,3,0,7,4,1,8,5,2]}[this.state.ownColor],a=0;a<9;a++){var n=t[a],i=this.state.cells["M".concat(n)];if(e.push(Object(b.jsx)(m,{cell:i,isSelected:this.isSelected(i),cellClicked:this.cellClicked},i.id)),2===a||5===a)for(var s=0;s<5;s++)e.push(Object(b.jsx)("div",{},"blank".concat(n).concat(s)));else 8!==a&&e.push(Object(b.jsx)("div",{},"blank".concat(n)))}return Object(b.jsx)("div",{className:"center-territory",children:e})}},{key:"renderFormationCells",value:function(){for(var e=[],t=0;t<6;t++)for(var a=0;a<5;a++){var n=this.state.formationCells["F".concat(t).concat(a)];e.push(Object(b.jsx)(m,{cell:n,isSelected:this.isSelected(n),cellClicked:this.formationCellClicked},n.id))}return Object(b.jsx)("div",{className:"player-territory",children:e})}},{key:"createLineBetweenCells",value:function(e,t,a,n,i){var s=this.board.getBoundingClientRect(),o=document.getElementById(t),r=document.getElementById(a),l=o.getBoundingClientRect(),c=r.getBoundingClientRect(),d=(l.left+l.right)/2-s.left,h=(l.top+l.bottom)/2-s.top,u=(c.left+c.right)/2-s.left,f=(c.top+c.bottom)/2-s.top;n?(e.beginPath(),e.strokeStyle=x,e.lineWidth=s.width/i*10,e.setLineDash([]),e.moveTo(d,h),e.lineTo(u,f),e.stroke(),e.beginPath(),e.strokeStyle=P,e.lineWidth=s.width/i*5,e.setLineDash([2,2]),e.moveTo(d,h),e.lineTo(u,f),e.stroke()):(e.beginPath(),e.strokeStyle="rgb(144,180,104)",e.lineWidth=s.width/i*3,e.setLineDash([]),e.moveTo(d,h),e.lineTo(u,f),e.stroke())}},{key:"createArcRail",value:function(e,t,a){var n=this.board.getBoundingClientRect(),i=document.getElementById(t),s=document.getElementById(a),o=i.getBoundingClientRect(),r=s.getBoundingClientRect(),l=(o.left+o.right)/2-n.left,c=(o.top+o.bottom)/2-n.top,d=(r.left+r.right)/2-n.left,h=(r.top+r.bottom)/2-n.top;console.log(this.board.offsetWidth,this.board.offsetHeight),e.beginPath(),e.strokeStyle=x,e.lineWidth=n.width/w*10,e.setLineDash([]),e.moveTo(l,c),e.arcTo(l,h,d,h,n.width/w*60),e.stroke(),e.beginPath(),e.strokeStyle=P,e.lineWidth=n.width/w*5,e.setLineDash([2,2]),e.moveTo(l,c),e.arcTo(l,h,d,h,n.width/w*60),e.stroke()}},{key:"drawArrowHead",value:function(e,t,a,n,i){var s,o,r=180*Math.atan2(a-i,t-n)/Math.PI,l=(r+45)*Math.PI/180,c=(r-45)*Math.PI/180,d=10*Math.cos(l),h=10*Math.sin(l),u=10*Math.cos(c),f=10*Math.sin(c);e.beginPath(),s=n+d,o=i+h,e.moveTo(s,o),e.lineTo(n,i),s=n+u,o=i+f,e.lineTo(s,o),e.lineWidth="4",e.strokeStyle="rgb(208,180,24)",e.stroke()}},{key:"drawLastMovePath",value:function(e){if(e){var t=this.board.getBoundingClientRect(),a=this.arrowCanvas.getContext("2d");this.arrowCanvas.style.width="100%",this.arrowCanvas.style.height="100%",this.arrowCanvas.width=this.arrowCanvas.offsetWidth,this.arrowCanvas.height=this.arrowCanvas.offsetHeight,a.clearRect(0,0,this.arrowCanvas.width,this.arrowCanvas.height);for(var n=0;n<e.length-1;n++){console.log("drawwing");var i=e[n],s=e[n+1],o=document.getElementById(i),r=document.getElementById(s);console.log(o,r);var l=o.getBoundingClientRect(),c=r.getBoundingClientRect(),d=(l.left+l.right)/2-t.left,h=(l.top+l.bottom)/2-t.top,u=(c.left+c.right)/2-t.left,f=(c.top+c.bottom)/2-t.top,v=t.width/w*10;console.log("head",v);var p=void 0,b=void 0;console.log(u,d,f,h);var C=v*Math.cos(45)/2,g=d-(u-d),j=h-(f-h),m=d,O=h;Math.abs(m-g)>1&&(m+=u>d?C:-C),Math.abs(O-j)>1&&(O+=f>h?C:-C);var y=180*Math.atan2(j-O,g-m)/Math.PI,k=(y+45)*Math.PI/180,x=(y-45)*Math.PI/180,P=v*Math.cos(k),S=v*Math.sin(k),R=v*Math.cos(x),M=v*Math.sin(x);a.beginPath(),p=m+P,b=O+S,a.moveTo(p,b),a.lineTo(m,O),p=m+R,b=O+M,a.lineTo(p,b),a.lineWidth=t.width/w*4,console.log(t.width/w*4),a.strokeStyle="rgb(208,180,24)",a.stroke()}}}},{key:"drawRoads",value:function(){var e=this;this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight;for(var t=this.canvas.getContext("2d"),a=new Set,n=new Set,i=this.state.ownColor,s=y[i],o=k[i],r=O[i],l=["".concat(i,"00"),"".concat(r,"04"),"".concat(r,"00"),"".concat(i,"04")],c=["".concat(s,"04"),"".concat(s,"00"),"".concat(o,"04"),"".concat(o,"00")],d=0;d<4;d++){var h=l[d],u=c[d];n.add("".concat(h).concat(u)),n.add("".concat(u).concat(h)),this.createArcRail(t,h,u)}var f=function(i){e.state.edges[i].forEach((function(s){if(!n.has("".concat(i).concat(s))&&!a.has("".concat(s).concat(i))){var o=e.state.cells,r=o[i].isOnRailroad&&o[s].isOnRailroad;e.createLineBetweenCells(t,i,s,r,w),a.add("".concat(i).concat(s))}}))};for(var v in this.state.edges)f(v);this.setState({roadsDrawn:!0})}},{key:"drawFormationRoads",value:function(){var e=this;console.log("draw"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight;var t=this.canvas.getContext("2d"),a=new Set,n=function(n){e.state.formationEdges[n].forEach((function(i){if(!a.has("".concat(i).concat(n))){var s=e.state.formationCells,o=s[n].isOnRailroad&&s[i].isOnRailroad;e.createLineBetweenCells(t,n,i,o,281),a.add("".concat(n).concat(i))}}))};for(var i in this.state.formationEdges)n(i);this.setState({roadsDrawn:!0})}},{key:"componentDidUpdate",value:function(e,t){this.state.isConnected&&!this.state.roadsDrawn&&this.drawRoads(),this.state.isConnected&&t.lastMovePath!==this.state.lastMovePath&&this.drawLastMovePath(this.state.lastMovePath),this.state.isConnected||this.state.roadsDrawn||this.drawFormationRoads()}},{key:"componentDidMount",value:function(){this.drawFormationRoads()}},{key:"joinGame",value:function(e){var t=this;fetch("https://junqi-server.herokuapp.com/connect",{method:"POST",credentials:"include"}).then((function(e){return e.json()})).then((function(a){var n=a.playerId,i=new WebSocket("wss://junqi-server.herokuapp.com"),s=[];for(var o in t.state.formationCells){var r=t.state.formationCells[o];r.piece&&s.push(r.piece.rank)}i.onopen=function(t){i.send(JSON.stringify({type:"join",data:{gameType:e,formation:s}})),console.log("sending","ugh")},i.onmessage=function(e){var a=JSON.parse(e.data),s=a.type,o=a.data;if("gamestate"===s)if(o.gameResult.isFinished)o.gameResult.winners.length?alert(o.gameResult.winners.includes(o.playerColors[n])?"you win :V":"you lose :v"):alert("draw"),t.state.ws.close(),t.setState({cells:null,edges:null,railPaths:null,playerId:null,ownColor:null,currentTurnColor:null,lastMovePath:[],roadsDrawn:!1,selectedCell:null,isConnected:!1,ws:null});else{var r={};if(t.state.isConnected)r=t.state.edges;else for(var l in o.board.edges)r[l]=new Set(Object.keys(o.board.edges[l]));var c=t.getLastMovePath(o.board.cellStates,r,o.moveHistory[o.moveHistory.length-1]);t.setState({playerId:n,cells:o.board.cellStates,edges:r,railPaths:o.board.railPaths,ownColor:o.playerColors[n],currentTurnColor:o.currentTurnColor,lastMovePath:c,isConnected:!0,roadsDrawn:!1,selectedCell:null,ws:i})}else"invalidmove"===s&&console.log("invalid move")},t.setState({ws:i})}))}},{key:"render",value:function(){var e=this;if(!this.state.isConnected){var t=this.renderFormationCells();return Object(b.jsxs)("div",{className:"lobby-container",children:[Object(b.jsxs)("div",{className:"button-container",children:[Object(b.jsx)("button",{onClick:function(){return e.joinGame("normal")},children:"Four player game"}),Object(b.jsx)("button",{onClick:function(){return e.joinGame("onevsai")},children:"Single player game"}),Object(b.jsx)("button",{onClick:function(){return e.joinGame("twoplayer")},children:"Two player game"})]}),Object(b.jsxs)("div",{className:"formation-container",ref:this.setBoardRef,children:[t,Object(b.jsx)("canvas",{ref:this.setCanvasRef,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}})]})]})}var a=this.renderTopCells(),n=this.renderLeftBottomRightCells(),i=Object(r.a)(n,3),s=i[0],o=i[1],l=i[2],c=this.renderCenterCells();return Object(b.jsx)("div",{className:"board-container",children:Object(b.jsxs)("div",{className:"board",ref:this.setBoardRef,children:[Object(b.jsx)("div",{className:"top-container",children:a}),Object(b.jsxs)("div",{className:"middle-container",children:[s,c,l]}),Object(b.jsx)("div",{className:"bottom-container",children:o}),Object(b.jsx)("canvas",{ref:this.setCanvasRef,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),Object(b.jsx)("canvas",{ref:this.setArrowCanvasRef,style:{position:"absolute",top:0,left:0,zIndex:2,pointerEvents:"none"}})]})})}}]),a}(i.a.Component);var R=function(){return Object(b.jsx)(S,{})},M=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,24)).then((function(t){var a=t.getCLS,n=t.getFID,i=t.getFCP,s=t.getLCP,o=t.getTTFB;a(e),n(e),i(e),s(e),o(e)}))};o.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(R,{})}),document.getElementById("root")),M()}},[[23,1,2]]]);
//# sourceMappingURL=main.a665629c.chunk.js.map
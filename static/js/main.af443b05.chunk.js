(this.webpackJsonpjunqi=this.webpackJsonpjunqi||[]).push([[0],{18:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var a=n(2),i=n.n(a),s=n(11),r=n.n(s),o=(n(18),n(13)),l=n(12),c=n(4),d=n(1),h=n(5),u=n(6),v=n(3),f=n(8),b=n(7),j=(n(19),n(20),n(21),n(0)),p={0:"\ud83d\udea9",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"\ud83d\udca3",100:"Mine"},g={O:"orange",B:"blue",G:"green",P:"purple"},C=function(e){Object(f.a)(n,e);var t=Object(b.a)(n);function n(e){return Object(h.a)(this,n),t.call(this,e)}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.piece,t="piece ".concat(g[e.color]);return this.props.isSelected&&(t+=" selected"),t+=" en",Object(j.jsx)("div",{className:t,children:null!=e.rank&&p[e.rank]})}}]),n}(i.a.Component),O=function(e){Object(f.a)(n,e);var t=Object(b.a)(n);function n(e){return Object(h.a)(this,n),t.call(this,e)}return Object(u.a)(n,[{key:"render",value:function(){var e,t,n=this,a=this.props.cell,i=a.piece;i&&(e=Object(j.jsx)(C,{piece:i,isSelected:this.props.isSelected}));var s="cell-svg";"normal"===a.type?t=Object(j.jsx)("rect",{width:"100%",height:"100%",rx:"4px",ry:"4px",strokeWidth:"4px",fill:"rgb(65,68,37)",stroke:"rgb(104,144,176)"}):"camp"===a.type?t=Object(j.jsx)("circle",{r:"60%",cx:"50%",cy:"50%",strokeWidth:"4px",fill:"rgb(65,68,37)",stroke:"rgb(192,144,88)"}):"base"===a.type?t=Object(j.jsx)("circle",{r:"40%",cx:"50%",cy:"50%",strokeWidth:"4px",fill:"rgb(65,68,37)",stroke:"rgb(144,180,104)"}):"center"===a.type&&(t=Object(j.jsx)("rect",{width:"100%",height:"100%",rx:"4px",ry:"4px",strokeWidth:"4px",fill:"rgb(65,68,37)",stroke:"rgb(104,144,176)"}),s+=" center-svg");return this.props.isInLastPath,Object(j.jsxs)("div",{className:"cell-container",onClick:function(){return n.props.cellClicked(a)},children:[e||a.id,Object(j.jsx)("svg",{id:a.id,className:s,children:t})]})}}]),n}(i.a.Component),m={O:"G",B:"P",G:"O",P:"B"},w={O:"B",B:"G",G:"P",P:"O"},y={O:"P",B:"O",G:"B",P:"G"},k=834,x="rgb(104,144,176)",P="rgb(200,236,240)",S=function(e){Object(f.a)(n,e);var t=Object(b.a)(n);function n(e){var a;Object(h.a)(this,n),a=t.call(this,e);for(var i={},s={},r=[9,1,6,3,3,5,6,7,8,1,7,10,4,2,3,5,1,2,100,10,2,100,100,0,4],o=0,l=function(e,t,n){null==e[t]&&(e[t]=new Set),e[t].add(n),null==e[n]&&(e[n]=new Set),e[n].add(t)},c=0;c<6;c++)for(var d=function(e){var t="F".concat(c).concat(e),n=void 0,a=null;"camp"!==(n=(1===c||3===c)&&(1===e||3===e)||2===c&&2===e?"camp":5!==c||1!==e&&3!==e?"normal":"base")&&(a={color:"O",rank:r[o]},o++);var d={id:t,piece:a,type:n,isOnRailroad:0===c||4===c||(0===e||4===e)&&5!==c};i[t]=d,c>0&&l(s,t,"F".concat(c-1).concat(e)),c<5&&l(s,t,"F".concat(c+1).concat(e)),e>0&&l(s,t,"F".concat(c).concat(e-1)),e<4&&l(s,t,"F".concat(c).concat(e+1)),"camp"===n&&[[c-1,e-1],[c-1,e+1],[c+1,e-1],[c+1,e+1]].forEach((function(e){return l(s,t,"F".concat(e[0]).concat(e[1]))}))},u=0;u<5;u++)d(u);return a.state={cells:null,edges:null,formationEdges:s,railPaths:null,playerId:null,ownColor:null,currentTurnColor:null,lastMovePath:[],formationCells:i,roadsDrawn:!1,selectedCell:null,isConnected:!1,ws:null,winners:null},a.board=null,a.canvas=null,a.arrowCanvas=null,a.setBoardRef=function(e){a.board=e},a.setCanvasRef=function(e){a.canvas=e},a.setArrowCanvasRef=function(e){a.arrowCanvas=e},a.cellClicked=a.cellClicked.bind(Object(v.a)(a)),a.drawRoads=a.drawRoads.bind(Object(v.a)(a)),a.formationCellClicked=a.formationCellClicked.bind(Object(v.a)(a)),a.joinGame=a.joinGame.bind(Object(v.a)(a)),a.surrender=a.surrender.bind(Object(v.a)(a)),a}return Object(u.a)(n,[{key:"cellClicked",value:function(e){var t=this,n=function(e){return"base"!==e.type&&e.piece&&100!==e.piece.rank&&t.isOwnPiece(e.piece)&&t.state.currentTurnColor===t.state.ownColor};if(this.state.selectedCell){var a=this.state.selectedCell;if(e.id===a.id)return void this.setState({selectedCell:null});this.isOwnPiece(e.piece)?n(e)&&this.setState({selectedCell:e}):(console.log("send"),this.state.ws.send(JSON.stringify({type:"move",data:{srcCellId:this.state.selectedCell.id,destCellId:e.id}})))}else n(e)&&this.setState({selectedCell:e})}},{key:"formationCellClicked",value:function(e){if(this.state.selectedCell){var t=this.state.selectedCell;if(e.id===t.id)return void this.setState({selectedCell:null});if("camp"===e.type)return;var n=parseInt(t.id[1]),a=parseInt(e.id[1]);if(10===t.piece.rank&&0===a||10===e.piece.rank&&0===n)return;if(100===t.piece.rank&&a<4||100===e.piece.rank&&n<4)return;if(0===t.piece.rank&&"base"!==e.type||0===e.piece.rank&&"base"!==t.type)return;t.piece,Object(d.a)(Object(d.a)({},this.state.formationCells),{},Object(c.a)({},t.id,Object(d.a)({},this.state)));this.setState((function(n){var a;t.piece;return{selectedCell:null,formationCells:Object(d.a)(Object(d.a)({},n.formationCells),{},(a={},Object(c.a)(a,t.id,Object(d.a)(Object(d.a)({},n.formationCells[t.id]),{},{piece:e.piece})),Object(c.a)(a,e.id,Object(d.a)(Object(d.a)({},n.formationCells[e.id]),{},{piece:t.piece})),a))}}))}else this.setState({selectedCell:e})}},{key:"isOwnPiece",value:function(e){return e&&e.color===this.state.ownColor}},{key:"getRailPath",value:function(e,t,n,a){if(!n.isOnRailroad||!a.isOnRailroad)return null;for(var i=new Map,s=[n],r=new Set([n.id]);s.length;){var o,c=s.shift(),d=t[c.id],h=Object(l.a)(d);try{for(h.s();!(o=h.n()).done;){var u=o.value;if(u===a.id){i.set(u,c.id);for(var v=[],f=a.id;null!=f;)v.unshift(f),f=i.get(f);return console.log("asdfad",v,i),v}var b=e[u];null==b.piece&&b.isOnRailroad&&!r.has(u)&&(r.add(u),s.push(b),i.set(u,c.id))}}catch(j){h.e(j)}finally{h.f()}}return null}},{key:"isValidMove",value:function(e){var t=this.state.selectedCell;if(t.id===e.id)return!1;if(e.piece&&this.isOwnPiece(e.piece))return!1;if(t.isOnRailroad&&e.isOnRailroad){if(1===t.piece.rank)return null!=this.getRailPath(t,e);var n=this.state.railPaths.find((function(n){return n.includes(t.id)&&n.includes(e.id)}));if(!n)return!1;for(var a=n.findIndex((function(e){return e===t.id})),i=n.findIndex((function(t){return t===e.id})),s=Math.min(a,i),r=Math.max(a,i),o=s+1;o<r;o++){if(null!=this.state.cells[n[o]].piece)return!1}return!0}return this.state.edges[t.id].has(e.id)}},{key:"comparePieces",value:function(e,t){return 10===e.rank||10===t.rank||e.rank===t.rank?null:1===e.rank&&100===t.rank||100===e.rank&&1===t.rank?1===e.rank?e:t:e.rank>t.rank?e:t}},{key:"moveSelectedPieceToCell",value:function(e){var t=this;this.setState((function(n){var a=n.selectedCell.id,i=n.selectedCell.piece,s=e.id,r=Object(d.a)(Object(d.a)({},n.cells),{},Object(c.a)({},a,Object(d.a)(Object(d.a)({},n.cells[a]),{},{piece:null})));return null==e.piece||t.comparePieces(i,e.piece)===i?r[s]=Object(d.a)(Object(d.a)({},n.cells[s]),{},{piece:i}):null==t.comparePieces(i,e.piece)&&(r[s]=Object(d.a)(Object(d.a)({},n.cells[s]),{},{piece:null})),{selectedCell:null,cells:r}}))}},{key:"getLastMovePath",value:function(e,t,n){if(!n)return[];n.color;var a=n.srcCellId,i=n.destCellId,s=e[a],r=e[i];if(console.log(s,r),s.isOnRailroad&&r.isOnRailroad){var o=this.getRailPath(e,t,s,r);return console.log(o),o}return[a,i]}},{key:"isSelected",value:function(e){return!!this.state.selectedCell&&this.state.selectedCell.id===e.id}},{key:"renderTopCells",value:function(){for(var e=[],t=5;t>=0;t--)for(var n=4;n>=0;n--){var a=this.state.cells["".concat(m[this.state.ownColor]).concat(t).concat(n)];e.push(Object(j.jsx)(O,{cell:a,isSelected:this.isSelected(a),cellClicked:this.cellClicked},a.id))}return Object(j.jsx)("div",{className:"player-territory top-territory",children:e})}},{key:"renderLeftBottomRightCells",value:function(){var e=this,t=[],n={W:"player-territory left-territory",S:"player-territory bottom-territory",E:"player-territory right-territory"};return["W","S","E"].forEach((function(a){var i,s=[];i="W"===a?w[e.state.ownColor]:"E"===a?y[e.state.ownColor]:e.state.ownColor;for(var r=0;r<6;r++)for(var o=0;o<5;o++){var l=e.state.cells["".concat(i).concat(r).concat(o)];s.push(Object(j.jsx)(O,{cell:l,isSelected:e.isSelected(l),cellClicked:e.cellClicked},l.id))}t.push(Object(j.jsx)("div",{className:n[a],children:s}))})),t}},{key:"renderCenterCells",value:function(){for(var e=[],t={O:[0,1,2,3,4,5,6,7,8],B:[2,5,8,1,4,7,0,3,6],G:[8,7,6,5,4,3,2,1,0],P:[6,3,0,7,4,1,8,5,2]}[this.state.ownColor],n=0;n<9;n++){var a=t[n],i=this.state.cells["M".concat(a)];if(e.push(Object(j.jsx)(O,{cell:i,isSelected:this.isSelected(i),cellClicked:this.cellClicked},i.id)),2===n||5===n)for(var s=0;s<5;s++)e.push(Object(j.jsx)("div",{},"blank".concat(a).concat(s)));else 8!==n&&e.push(Object(j.jsx)("div",{},"blank".concat(a)))}return Object(j.jsx)("div",{className:"center-territory",children:e})}},{key:"renderFormationCells",value:function(){for(var e=[],t=0;t<6;t++)for(var n=0;n<5;n++){var a=this.state.formationCells["F".concat(t).concat(n)];e.push(Object(j.jsx)(O,{cell:a,isSelected:this.isSelected(a),cellClicked:this.formationCellClicked},a.id))}return Object(j.jsx)("div",{className:"player-territory",children:e})}},{key:"createLineBetweenCells",value:function(e,t,n,a,i){var s=this.board.getBoundingClientRect(),r=document.getElementById(t),o=document.getElementById(n),l=r.getBoundingClientRect(),c=o.getBoundingClientRect(),d=(l.left+l.right)/2-s.left,h=(l.top+l.bottom)/2-s.top,u=(c.left+c.right)/2-s.left,v=(c.top+c.bottom)/2-s.top;a?(e.beginPath(),e.strokeStyle=x,e.lineWidth=s.width/i*10,e.setLineDash([]),e.moveTo(d,h),e.lineTo(u,v),e.stroke(),e.beginPath(),e.strokeStyle=P,e.lineWidth=s.width/i*5,e.setLineDash([2,2]),e.moveTo(d,h),e.lineTo(u,v),e.stroke()):(e.beginPath(),e.strokeStyle="rgb(144,180,104)",e.lineWidth=s.width/i*3,e.setLineDash([]),e.moveTo(d,h),e.lineTo(u,v),e.stroke())}},{key:"createArcRail",value:function(e,t,n){var a=this.board.getBoundingClientRect(),i=document.getElementById(t),s=document.getElementById(n),r=i.getBoundingClientRect(),o=s.getBoundingClientRect(),l=(r.left+r.right)/2-a.left,c=(r.top+r.bottom)/2-a.top,d=(o.left+o.right)/2-a.left,h=(o.top+o.bottom)/2-a.top;console.log(this.board.offsetWidth,this.board.offsetHeight),e.beginPath(),e.strokeStyle=x,e.lineWidth=a.width/k*10,e.setLineDash([]),e.moveTo(l,c),e.arcTo(l,h,d,h,a.width/k*60),e.stroke(),e.beginPath(),e.strokeStyle=P,e.lineWidth=a.width/k*5,e.setLineDash([2,2]),e.moveTo(l,c),e.arcTo(l,h,d,h,a.width/k*60),e.stroke()}},{key:"drawArrowHead",value:function(e,t,n,a,i){var s,r,o=180*Math.atan2(n-i,t-a)/Math.PI,l=(o+45)*Math.PI/180,c=(o-45)*Math.PI/180,d=10*Math.cos(l),h=10*Math.sin(l),u=10*Math.cos(c),v=10*Math.sin(c);e.beginPath(),s=a+d,r=i+h,e.moveTo(s,r),e.lineTo(a,i),s=a+u,r=i+v,e.lineTo(s,r),e.lineWidth="4",e.strokeStyle="rgb(208,180,24)",e.stroke()}},{key:"drawLastMovePath",value:function(e){if(e){var t=this.board.getBoundingClientRect(),n=this.arrowCanvas.getContext("2d");this.arrowCanvas.style.width="100%",this.arrowCanvas.style.height="100%",this.arrowCanvas.width=this.arrowCanvas.offsetWidth,this.arrowCanvas.height=this.arrowCanvas.offsetHeight,n.clearRect(0,0,this.arrowCanvas.width,this.arrowCanvas.height);for(var a=0;a<e.length-1;a++){console.log("drawwing");var i=e[a],s=e[a+1],r=document.getElementById(i),o=document.getElementById(s);console.log(r,o);var l=r.getBoundingClientRect(),c=o.getBoundingClientRect(),d=(l.left+l.right)/2-t.left,h=(l.top+l.bottom)/2-t.top,u=(c.left+c.right)/2-t.left,v=(c.top+c.bottom)/2-t.top,f=t.width/k*10;console.log("head",f);var b=void 0,j=void 0;console.log(u,d,v,h);var p=f*Math.cos(45)/2,g=d-(u-d),C=h-(v-h),O=d,m=h;Math.abs(O-g)>1&&(O+=u>d?p:-p),Math.abs(m-C)>1&&(m+=v>h?p:-p);var w=180*Math.atan2(C-m,g-O)/Math.PI,y=(w+45)*Math.PI/180,x=(w-45)*Math.PI/180,P=f*Math.cos(y),S=f*Math.sin(y),R=f*Math.cos(x),M=f*Math.sin(x);n.beginPath(),b=O+P,j=m+S,n.moveTo(b,j),n.lineTo(O,m),b=O+R,j=m+M,n.lineTo(b,j),n.lineWidth=t.width/k*4,console.log(t.width/k*4),n.strokeStyle="rgb(208,180,24)",n.stroke()}}}},{key:"drawRoads",value:function(){var e=this;this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight;for(var t=this.canvas.getContext("2d"),n=new Set,a=new Set,i=this.state.ownColor,s=w[i],r=y[i],o=m[i],l=["".concat(i,"00"),"".concat(o,"04"),"".concat(o,"00"),"".concat(i,"04")],c=["".concat(s,"04"),"".concat(s,"00"),"".concat(r,"04"),"".concat(r,"00")],d=0;d<4;d++){var h=l[d],u=c[d];a.add("".concat(h).concat(u)),a.add("".concat(u).concat(h)),this.createArcRail(t,h,u)}var v=function(i){e.state.edges[i].forEach((function(s){if(!a.has("".concat(i).concat(s))&&!n.has("".concat(s).concat(i))){var r=e.state.cells,o=r[i].isOnRailroad&&r[s].isOnRailroad;e.createLineBetweenCells(t,i,s,o,k),n.add("".concat(i).concat(s))}}))};for(var f in this.state.edges)v(f);this.setState({roadsDrawn:!0})}},{key:"drawFormationRoads",value:function(){var e=this;console.log("draw"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight;var t=this.canvas.getContext("2d"),n=new Set,a=function(a){e.state.formationEdges[a].forEach((function(i){if(!n.has("".concat(i).concat(a))){var s=e.state.formationCells,r=s[a].isOnRailroad&&s[i].isOnRailroad;e.createLineBetweenCells(t,a,i,r,281),n.add("".concat(a).concat(i))}}))};for(var i in this.state.formationEdges)a(i);this.setState({roadsDrawn:!0})}},{key:"componentDidUpdate",value:function(e,t){this.state.isConnected&&!this.state.roadsDrawn&&this.drawRoads(),this.state.isConnected&&t.lastMovePath!==this.state.lastMovePath&&this.drawLastMovePath(this.state.lastMovePath),this.state.isConnected||this.state.roadsDrawn||this.drawFormationRoads(),null!=this.state.winners&&null==t.winner&&(this.state.winners.length?alert(this.state.winners.includes(this.state.ownColor)?"you win :V":"you lose :v"):alert("draw"),this.state.ws.close(),this.setState({cells:null,edges:null,railPaths:null,playerId:null,ownColor:null,currentTurnColor:null,lastMovePath:[],roadsDrawn:!1,selectedCell:null,isConnected:!1,ws:null,winners:null}))}},{key:"componentDidMount",value:function(){this.drawFormationRoads()}},{key:"joinGame",value:function(e){var t=this;fetch("https://junqi-server.herokuapp.com/connect",{method:"POST",credentials:"include"}).then((function(e){return e.json()})).then((function(n){var a=n.playerId,i=new WebSocket("wss://https://junqi-server.herokuapp.com"),s=[];for(var r in t.state.formationCells){var o=t.state.formationCells[r];o.piece&&s.push(o.piece.rank)}i.onopen=function(t){i.send(JSON.stringify({type:"join",data:{gameType:e,formation:s}})),console.log("sending","ugh")},i.onmessage=function(e){var n=JSON.parse(e.data),s=n.type,r=n.data;if("gamestate"===s){var o={};if(t.state.isConnected)o=t.state.edges;else for(var l in r.board.edges)o[l]=new Set(Object.keys(r.board.edges[l]));var c=t.getLastMovePath(r.board.cellStates,o,r.moveHistory[r.moveHistory.length-1]);t.setState({playerId:a,cells:r.board.cellStates,edges:o,railPaths:r.board.railPaths,ownColor:r.playerColors[a],currentTurnColor:r.currentTurnColor,lastMovePath:c,isConnected:!0,roadsDrawn:!1,selectedCell:null,ws:i,winners:r.gameResult.isFinished?r.gameResult.winners:null})}else"invalidmove"===s&&console.log("invalid move")},t.setState({ws:i})}))}},{key:"surrender",value:function(){this.state.ws.send(JSON.stringify({type:"surrender"}))}},{key:"render",value:function(){var e=this,t=Object(j.jsxs)("div",{className:"rules",children:["Rules:",Object(j.jsx)("br",{}),"Goal is to take opponent players' \ud83d\udea9",Object(j.jsx)("br",{}),"Attacking:",Object(j.jsx)("br",{}),"9>8>7>6>5>4>3>2>1",Object(j.jsx)("br",{}),"Mine > all except loses to 1",Object(j.jsx)("br",{}),"\ud83d\udca3 explodes vs all",Object(j.jsx)("br",{}),"When 9 dies, \ud83d\udea9 becomes visible",Object(j.jsx)("br",{}),"Orange circle is safe zone",Object(j.jsx)("br",{}),"Movement:",Object(j.jsx)("br",{}),"Pieces can move from one cell to adjacent cell with green road",Object(j.jsx)("br",{}),"Pieces can move any number of cells in a straight line on the blue railroad",Object(j.jsx)("br",{}),"Exception: 1 can also turn on railroad",Object(j.jsx)("br",{}),'Mine and pieces in "base" cells (last row 2nd and 4th column) \ud83d\udea9 cannot move',Object(j.jsx)("br",{}),"Formation:",Object(j.jsx)("br",{}),"Bomb cannot be placed on first row.",Object(j.jsx)("br",{}),"Mine can only be placed in last two rows",Object(j.jsx)("br",{}),'\ud83d\udea9 can only be placed in "base" cells',Object(j.jsx)("br",{})]});if(!this.state.isConnected){var n=this.renderFormationCells();return Object(j.jsxs)("div",{className:"lobby-container",children:[t,Object(j.jsxs)("div",{className:"button-container",children:[Object(j.jsx)("button",{onClick:function(){return e.joinGame("normal")},children:"Four player game"}),Object(j.jsx)("button",{onClick:function(){return e.joinGame("onevsai")},children:"Single player game"}),Object(j.jsx)("button",{onClick:function(){return e.joinGame("twoplayer")},children:"Two player game"})]}),Object(j.jsxs)("div",{className:"formation-container",ref:this.setBoardRef,children:[n,Object(j.jsx)("canvas",{ref:this.setCanvasRef,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}})]})]})}var a=this.renderTopCells(),i=this.renderLeftBottomRightCells(),s=Object(o.a)(i,3),r=s[0],l=s[1],c=s[2],d=this.renderCenterCells();return Object(j.jsxs)("div",{className:"board-container",children:[Object(j.jsxs)("div",{className:"board",ref:this.setBoardRef,children:[Object(j.jsx)("div",{className:"top-container",children:a}),Object(j.jsxs)("div",{className:"middle-container",children:[r,d,c]}),Object(j.jsx)("div",{className:"bottom-container",children:l}),Object(j.jsx)("canvas",{ref:this.setCanvasRef,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),Object(j.jsx)("canvas",{ref:this.setArrowCanvasRef,style:{position:"absolute",top:0,left:0,zIndex:2,pointerEvents:"none"}})]}),Object(j.jsx)("button",{onClick:this.surrender,children:"Surrender"}),t]})}}]),n}(i.a.Component);var R=function(){return Object(j.jsx)(S,{})},M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,24)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),i(e),s(e),r(e)}))};r.a.render(Object(j.jsx)(i.a.StrictMode,{children:Object(j.jsx)(R,{})}),document.getElementById("root")),M()}},[[23,1,2]]]);